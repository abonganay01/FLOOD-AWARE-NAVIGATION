<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI FloodSafe Navigator — NOAH Base Map</title>

  <!-- ensure relative assets resolve when served from a repo subpath (GitHub Pages) -->
  <base href="./" />

  <!-- site styles -->
  <link rel="stylesheet" href="css/styles.css" />

  <!-- MapLibre (no API key required) -->
  <!-- Use explicit https:// URLs (not protocol-relative) so they load reliably -->
  <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet" />
  <script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>

  <!-- Minimal inline layout styles to ensure map container is visible -->
  <style>
    /* Ensure app fills viewport and map has height */
    html, body { height: 100%; margin: 0; }
    .app-root { display: flex; height: 100vh; min-height: 100vh; }
    aside.panel { width: 320px; max-width: 40%; box-sizing: border-box; overflow-y: auto; padding: 1rem; }
    main.map-container { flex: 1 1 auto; display: flex; }
    #map { flex: 1 1 auto; min-height: 0; height: 100%; }
    /* simple marker style (keeps existing app visuals) */
    .flood-marker { width: 12px; height: 12px; background: rgba(200,30,30,0.9); border-radius: 50%; border: 2px solid white; box-shadow: 0 0 3px rgba(0,0,0,0.3); }

    /* user location marker */
    .user-location-marker { width: 14px; height: 14px; background: #2b8cff; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 4px rgba(43,140,255,0.6); }
  </style>
</head>
<body>
  <div id="app" class="app-root">
    <aside class="panel">
      <h1>AI FloodSafe Navigator</h1>
      <p class="lead">Using Project NOAH as the basemap (if available). Crowd reports stored locally; AI will be added later.</p>

      <form id="route-form">
        <label for="origin">Origin (lat,lng or address)</label>
        <div style="display:flex;gap:8px;align-items:center;">
          <input id="origin" placeholder="e.g. 14.6760,121.0437 or Quezon City" style="flex:1" />
          <!-- added: use current location button -->
          <button id="loc-btn" type="button" title="Use current location">Use current location</button>
        </div>

        <label for="destination">Destination (lat,lng or address)</label>
        <input id="destination" placeholder="e.g. 14.5547,121.0244 or Makati" />

        <label for="threshold">Risk threshold</label>
        <input id="threshold" type="number" value="2" min="0" />

        <button id="go-btn" type="submit">Calculate & Navigate</button>
      </form>

      <div class="status-box">
        <strong>Status:</strong>
        <pre id="status">Idle</pre>
      </div>

      <div class="actions">
        <button id="clear-memory" type="button">Clear Local Flood Memory</button>
      </div>

      <hr />

      <!-- Weather summary for origin & destination -->
      <div class="weather-box">
        <h3>Weather</h3>
        <div id="weather-origin">Origin: <em>none</em></div>
        <div id="weather-destination">Destination: <em>none</em></div>
      </div>

      <!-- Turn-by-turn directions -->
      <div class="directions-box">
        <h3>Directions</h3>
        <div id="directions-wrap">
          <div id="directions-summary"></div>
          <ol id="directions"></ol>
        </div>
      </div>

      <hr />

      <p class="notes">Tip: deploy to Vercel for serverless /api proxies (AccuWeather / NOAH). GitHub Pages can host the static app but has no serverless /api endpoints — the app will gracefully skip proxy-dependent features.</p>
    </aside>

    <main class="map-container">
      <div id="map"></div>
    </main>
  </div>

  <!-- app script (will attempt to use NOAH tiles/GeoJSON, fallback to MapLibre demo) -->
  <script type="module" src="js/app.js"></script>
</body>
</html>
